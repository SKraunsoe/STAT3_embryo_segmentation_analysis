# STAT3_embryo_segmentation_analysis
Fiji macros, R script and links to Google Colab notebooks (3D Stardist segmentation) for the analysis of transcription factors (STAT3, TFCP2L1, NANOG) in E3.5, E4.5 and diapause mouse embryos. 

This repository contains the Fiji macros and R script used to analyse and quantify the expression patterns of STAT3 and TFCP2L1 in mouse embryos which we use to support the qualitative observation that expression of STAT3 and its target, TFCP2L1 is enhanced in the ICM of diapaused mouse embryos. See our paper for more details.  

There are four sections to this analysis pipeline which must be run in order. 

1. The first Fiji macro, "Image pre-processing macro to prepare images for 3D stardist segmentation.ijm" takes the raw 4-channel images (in tif format) and processes them so they are ready to be fed into the 3D Stardist segmentation script. If images are not in .tif format or have more than one channel, then the macro will need to be modified slighly to account for this. The 3D Image J Suite plugin (Ollion et al., 2013) is required to run the Fiji macros in this analysis. 

2. The second stage of the process involves using a Google Colab notebook developed by the Jacquemet and Henriques laboratories as part of the Zero-Cost Deep-Learning to Enhance Microscopy project (https://github.com/HenriquesLab/DeepLearning_Collab/wiki) (von Chamier et al., 2021). This notebook (https://colab.research.google.com/github/HenriquesLab/ZeroCostDL4Mic/blob/master/Colab_notebooks/StarDist_3D_ZeroCostDL4Mic.ipynb) uses the 3D Stardist segmentation algorith development by Martin Weigert and Uwe Schmidt (Weigert et al., 2019, Schmidt et al., 2018). The notebook facilitates all stages of the training of a model to segment unseen data but requires the training of a dataset of raw images and the corresponding segmentation which can be manually generated with tools such as the Labkit plugin in Fiji, which allow for easy annotation, or using existing segmented datasets from programmes such as MINS (Lou et al., 2014). Once the segmentation has been generated, you can export the .tif files from the Google Colab notebook. 

3. The second Fiji macro, "Image post-processing macro to generate 3D quantification data" combines the output of the segmentation with the raw image as an additional channel and then uses the 3D Image J Suite toolbox to quantify the intensity of the pixel values in each channel per segmented object (nuclei). The macro also measures morphological parameters (e.g., sphericity, volume, xyz coordinates) for each segmented object (nuclei). The data is exported as 5 separate csvs per image, one for the morphological data and one for each of the four channels.

4. The final stage of the analysis involves visualising the data using ggplot in R to generate violin plots of expression levels in different embryo stages, plotly to generate 3D in silico representations of the embryos colour coded by expression values and the fsh function to isolate and localise nuclei with high expression values for particular transcription factors. This script could be adapted to generate differnt styles of graphs. The following R packages are required to run this analysis: tidyverse, ggplot2, BiocManager, limma, org.Mm.eg.db, readr, dplyr, data.table, plotly, factoextra, viridis, reshape2, gplots, ggpubr, remotes, data.table, plotly, factoextra, reshape2, gatepoints. 

References:
Lou, X., Kang, M., Xenopoulos, P., Muñoz-Descalzo, S., & Hadjantonakis, A. K. (2014). A Rapid and Efficient 2D/3D Nuclear Segmentation Method for Analysis of Early Mouse Embryo and Stem Cell Image Data. Stem Cell Reports, 2(3), 382–397. https://doi.org/10.1016/J.STEMCR.2014.01.010
Ollion, J., Cochennec, J., Loll, F., Escudé, C., & Boudier, T. (2013). TANGO: A generic tool for high-throughput 3D image analysis for studying nuclear organization. Bioinformatics, 29(14), 1840–1841. https://doi.org/10.1093/bioinformatics/btt276
Pietzsch, T., Saalfeld, S., Preibisch, S., & Tomancak, P. (2015). BigDataViewer: Visualization and processing for large image data sets. In Nature Methods (Vol. 12, Issue 6, pp. 481–483). Nature Publishing Group. https://doi.org/10.1038/nmeth.3392
Schmid, B., Schindelin, J., Cardona, A., Longair, M., & Heisenberg, M. (2010). A high-level 3D visualization API for Java and ImageJ. BMC Bioinformatics, 11(1), 1–7. https://doi.org/10.1186/1471-2105-11-274/FIGURES/5
Schmidt, U., Weigert, M., Broaddus, C., & Myers, G. (2018). Cell Detection with Star-convex Polygons. Lecture Notes in Computer Science (Including Subseries Lecture Notes in Artificial Intelligence and Lecture Notes in Bioinformatics), 11071 LNCS, 265–273. https://doi.org/10.1007/978-3-030-00934-2_30
von Chamier, L., Laine, R. F., Jukkala, J., Spahn, C., Krentzel, D., Nehme, E., Lerche, M., Hernández-Pérez, S., Mattila, P. K., Karinou, E., Holden, S., Solak, A. C., Krull, A., Buchholz, T.-O., Jones, M. L., Royer, L. A., Leterrier, C., Shechtman, Y., Jug, F., … Henriques, R. (2021). Democratising deep learning for microscopy with ZeroCostDL4Mic. Nature Communications, 12(1), 2276. https://doi.org/10.1038/s41467-021-22518-0
Weigert, M., Schmidt, U., Haase, R., Sugawara, K., & Myers, G. (2020). Star-convex polyhedra for 3D object detection and segmentation in microscopy. Proceedings - 2020 IEEE Winter Conference on Applications of Computer Vision, WACV 2020, 3655–3662. https://doi.org/10.1109/WACV45572.2020.9093435
Wickham, H. (2016). ggplot2. https://doi.org/10.1007/978-3-319-24277-4
